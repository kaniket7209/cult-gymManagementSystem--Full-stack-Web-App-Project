{% extends "layout.html" %}

{% block y %}
<h1><span class="font-italic font-weight-bold" style="color: #0d5125">
        Hi {{session.username}} Please mark your attendance</span></h1>



{% from "includes/formhelpers.html" import render_field %}
<form method="POST" action="">

    <p>Click the button to mark your attendance</p>
    <button name="loc" onclick="getLocation()">Mark Attendance</button>

</form>


<p id="attendance"></p>

<script>
    var x = document.getElementById("attendance");

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);

        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {

        // x.innerHTML = "Latitude: " + position.coords.latitude +
        //     "<br>Longitude: " + position.coords.longitude;

 
        const location = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
        };
        fetch(`http://127.0.0.1:5000/attendance/`, {
            method: "POST",
            credentials: "include",
            body: JSON.stringify(location),
            cache: "no-cache",
            headers: new Headers({
                "content-type": "application/json"
            })
        })
            .then(function (response) {
                if (response.status !== 200) {
                    console.log(`Looks like there was a problem. Status code: ${response.status}`);
                    return;
                }
                response.json().then(function (data) {
                    console.log(data);
                });
            })
            .catch(function (error) {
                console.log("Fetch error: " + error);
            });
        console.log(location.latitude, "-----", location.longitude)
    }

</script>

<button onclick="history.back()">
    Click here to go back
</button>
{% endblock %}